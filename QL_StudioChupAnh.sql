CREATE DATABASE QL_STUDIO ON PRIMARY(
	NAME=DB_PRIMARY,
	FILENAME='E:\TH_HQT_CSDL\DoAn\Official\db_primary.mdf',
	SIZE=4MB,
	MAXSIZE=10MB,
	FILEGROWTH=10%
)
LOG ON
(
	NAME=DB_LOG,
	FILENAME='E:\TH_HQT_CSDL\DoAn\Official\db_log.ldf',
	SIZE=1MB,
	MAXSIZE=2MB,
	FILEGROWTH=10%
)
GO
USE QL_STUDIO
GO

SET DATEFORMAT DMY
CREATE TABLE KHACHHANG (
	MAKH VARCHAR(10) NOT NULL,
	HOTEN NVARCHAR(50) NULL,
	GIOITINH NVARCHAR(5) DEFAULT N'NAM',
	NGAYSINH DATE NULL,
	SDT CHAR(10) NULL,
	DIACHI NVARCHAR(200) NULL
);
ALTER TABLE KHACHHANG
ADD CONSTRAINT PK_MAKH_KH PRIMARY KEY (MAKH)

CREATE TABLE NHANVIEN (
	MANV VARCHAR(10) NOT NULL,
	HOTEN NVARCHAR(50) NULL,
	SDT CHAR(10),
	DIACHI NVARCHAR(200) NULL,
	GIOITINH NVARCHAR(5) NULL,
	CHUCVU NVARCHAR(30) NULL,
	MAQUANLY VARCHAR(10) NULL,
	NGAYSINH DATE NULL
);
ALTER TABLE NHANVIEN
ADD CONSTRAINT PK_MANV_NV PRIMARY KEY (MANV)
GO
ALTER TABLE NHANVIEN 
ADD CONSTRAINT FK_MAQL_NV FOREIGN KEY(MAQUANLY) REFERENCES NHANVIEN(MANV)
GO
CREATE TABLE HOADON (
	MAHD VARCHAR(10) NOT NULL,
	NGAYLAPHD DATE default getdate(),
	MANV VARCHAR(10) NULL
)
ALTER TABLE HOADON
ADD CONSTRAINT PK_MAHD_HD PRIMARY KEY (MAHD),
	CONSTRAINT FK_MANV_HD FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV),
	CONSTRAINT UNI_HOADON UNIQUE(MAHD, NGAYLAPHD, MANV)

CREATE TABLE PHIEUDANGKY (
	MADK VARCHAR(10) NOT NULL,
	NGAYDANGKY DATE default getdate(),
	MAKH VARCHAR(10) NOT NULL,
	GHICHU NVARCHAR(300) default null,
	MADV VARCHAR(10) NOT NULL
)
ALTER TABLE PHIEUDANGKY
ADD 
	CONSTRAINT FK_MAKH_PDK FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH),
	CONSTRAINT FK_MADV_PDK FOREIGN KEY (MADV) REFERENCES DICHVU(MADV)

CREATE TABLE DICHVU (
	MADV VARCHAR(10) NOT NULL,
	TENDV NVARCHAR(50) NULL,
	MOTA NVARCHAR(300) NULL,
	GIA FLOAT default 0
)
ALTER TABLE DICHVU
ADD CONSTRAINT PK_MADV_DV PRIMARY KEY (MADV)

CREATE TABLE CHITIETHD(
	MAHD VARCHAR(10) NOT NULL,
	MAKH VARCHAR(10) NOT NULL,
	MADV VARCHAR(10) NOT NULL
)
ALTER TABLE CHITIETHD
ADD CONSTRAINT PK_MAHD_MAKH_MADV PRIMARY KEY (MAHD, MAKH, MADV),
	CONSTRAINT FK_MAHD_CTHD FOREIGN KEY (MAHD) REFERENCES HOADON(MAHD),
	CONSTRAINT FK_MAKH_CTHD FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH),
	CONSTRAINT FK_MADV_CTHD FOREIGN KEY (MADV) REFERENCES DICHVU(MADV)


-- insert data
USE [QL_Studio]
GO
INSERT [dbo].[KHACHHANG] ([MAKH], [HOTEN], [GIOITINH], [NGAYSINH], [SDT], [DIACHI]) VALUES (N'KH22000001', N'Nguyễn Đình Trọng', N'Nam', CAST(N'2000-02-01' AS Date), N'0972183245', N'TP.HCM')
INSERT [dbo].[KHACHHANG] ([MAKH], [HOTEN], [GIOITINH], [NGAYSINH], [SDT], [DIACHI]) VALUES (N'KH22000002', N'Lâm Bảo Ngọc', N'Nữ', CAST(N'2000-03-02' AS Date), N'0381647473', N'Đà Nẵng')
INSERT [dbo].[KHACHHANG] ([MAKH], [HOTEN], [GIOITINH], [NGAYSINH], [SDT], [DIACHI]) VALUES (N'KH22000003', N'Hồ Vấn Vương', N'Nam', CAST(N'2001-06-04' AS Date), N'0347383631', N'Đà Lạt')
INSERT [dbo].[KHACHHANG] ([MAKH], [HOTEN], [GIOITINH], [NGAYSINH], [SDT], [DIACHI]) VALUES (N'KH22000004', N'Lê Thanh Thúy', N'Nữ', CAST(N'2001-12-09' AS Date), N'0148394829', N'Tiền Giang')
INSERT [dbo].[KHACHHANG] ([MAKH], [HOTEN], [GIOITINH], [NGAYSINH], [SDT], [DIACHI]) VALUES (N'KH22000005', N'Trần Bảo Bảo', N'Nam', CAST(N'2000-10-20' AS Date), N'0314831349', N'Đồng Tháp')
GO
INSERT [dbo].[NHANVIEN] ([MANV], [HOTEN], [SDT], [DIACHI], [GIOITINH], [CHUCVU], [MAQUANLY], [NGAYSINH]) VALUES (N'NV20220001', N'Nguyễn Văn Anh', N'0913247362', N'TP.HCM', N'Nam', N'Nhân Viên', NULL, NULL)
INSERT [dbo].[NHANVIEN] ([MANV], [HOTEN], [SDT], [DIACHI], [GIOITINH], [CHUCVU], [MAQUANLY], [NGAYSINH]) VALUES (N'NV20220002', N'Nguyễn Thị Bé', N'0321491392', N'Đồng Nai', N'Nữ', N'Nhân Viên', N'NV20220001', NULL)
INSERT [dbo].[NHANVIEN] ([MANV], [HOTEN], [SDT], [DIACHI], [GIOITINH], [CHUCVU], [MAQUANLY], [NGAYSINH]) VALUES (N'NV20220003', N'Trần Thanh Cảnh', N'0132943024', N'Long An', N'Nam', N'Nhân Viên', N'NV20220001', NULL)
INSERT [dbo].[NHANVIEN] ([MANV], [HOTEN], [SDT], [DIACHI], [GIOITINH], [CHUCVU], [MAQUANLY], [NGAYSINH]) VALUES (N'NV20220004', N'Mai Thị Hồng', N'0283748178', N'Bến Tre', N'Nữ', N'Nhân Viên', N'NV20220001', NULL)
INSERT [dbo].[NHANVIEN] ([MANV], [HOTEN], [SDT], [DIACHI], [GIOITINH], [CHUCVU], [MAQUANLY], [NGAYSINH]) VALUES (N'NV20220005', N'Lâm Thúy Kiều', N'0494741393', N'Cần Thơ', N'Nữ', N'Nhân Viên', N'NV20220001', NULL)
GO
INSERT [dbo].[HOADON] ([MAHD], [NGAYLAPHD], [MANV]) VALUES (N'HD22000001', CAST(N'2022-02-02' AS Date), N'NV20220001')
INSERT [dbo].[HOADON] ([MAHD], [NGAYLAPHD], [MANV]) VALUES (N'HD22000002', CAST(N'2022-03-03' AS Date), N'NV20220001')
INSERT [dbo].[HOADON] ([MAHD], [NGAYLAPHD], [MANV]) VALUES (N'HD22000003', CAST(N'2022-02-28' AS Date), N'NV20220002')
INSERT [dbo].[HOADON] ([MAHD], [NGAYLAPHD], [MANV]) VALUES (N'HD22000004', CAST(N'2022-03-06' AS Date), N'NV20220002')
INSERT [dbo].[HOADON] ([MAHD], [NGAYLAPHD], [MANV]) VALUES (N'HD22000005', CAST(N'2022-03-20' AS Date), N'NV20220003')
INSERT [dbo].[HOADON] ([MAHD], [NGAYLAPHD], [MANV]) VALUES (N'HD22000006', CAST(N'2022-04-01' AS Date), N'NV20220003')
INSERT [dbo].[HOADON] ([MAHD], [NGAYLAPHD], [MANV]) VALUES (N'HD22000007', CAST(N'2022-04-10' AS Date), N'NV20220004')
INSERT [dbo].[HOADON] ([MAHD], [NGAYLAPHD], [MANV]) VALUES (N'HD22000008', CAST(N'2022-04-23' AS Date), N'NV20220004')
INSERT [dbo].[HOADON] ([MAHD], [NGAYLAPHD], [MANV]) VALUES (N'HD22000009', CAST(N'2022-05-05' AS Date), N'NV20220005')
INSERT [dbo].[HOADON] ([MAHD], [NGAYLAPHD], [MANV]) VALUES (N'HD22000010', CAST(N'2022-05-10' AS Date), N'NV20220005')
INSERT [dbo].[HOADON] ([MAHD], [NGAYLAPHD], [MANV]) VALUES (N'HD22000011', CAST(N'2022-05-28' AS Date), N'NV20220002')
INSERT [dbo].[HOADON] ([MAHD], [NGAYLAPHD], [MANV]) VALUES (N'HD22000012', CAST(N'2022-06-04' AS Date), N'NV20220004')
GO
INSERT [dbo].[DICHVU] ([MADV], [TENDV], [MOTA], [GIA]) VALUES (N'DV22000001', N'Chụp ảnh cưới (combo1)', N'chụp là đẹp', 2000000)
INSERT [dbo].[DICHVU] ([MADV], [TENDV], [MOTA], [GIA]) VALUES (N'DV22000002', N'Chụp ảnh cưới (combo2)', N'đẹp mới chụp', 1500000)
INSERT [dbo].[DICHVU] ([MADV], [TENDV], [MOTA], [GIA]) VALUES (N'DV22000003', N'Thuê áo cưới', N'đồ đẹp mới cho thuê', 2000000)
INSERT [dbo].[DICHVU] ([MADV], [TENDV], [MOTA], [GIA]) VALUES (N'DV22000004', N'Trang trí đám cưới', N'bao đẹp miễn chê', 4000000)
INSERT [dbo].[DICHVU] ([MADV], [TENDV], [MOTA], [GIA]) VALUES (N'DV22000005', N'makeup', N'xuất sắc 10đ', 1500000)
INSERT [dbo].[DICHVU] ([MADV], [TENDV], [MOTA], [GIA]) VALUES (N'DV22000006', N'Thuê xe', N'good', 2500000)
GO
INSERT [dbo].[CHITIETHD] ([MAHD], [MAKH], [MADV]) VALUES (N'HD22000001', N'KH22000001', N'DV22000001')
INSERT [dbo].[CHITIETHD] ([MAHD], [MAKH], [MADV]) VALUES (N'HD22000007', N'KH22000001', N'DV22000002')
INSERT [dbo].[CHITIETHD] ([MAHD], [MAKH], [MADV]) VALUES (N'HD22000012', N'KH22000001', N'DV22000004')
INSERT [dbo].[CHITIETHD] ([MAHD], [MAKH], [MADV]) VALUES (N'HD22000001', N'KH22000001', N'DV22000005')
INSERT [dbo].[CHITIETHD] ([MAHD], [MAKH], [MADV]) VALUES (N'HD22000002', N'KH22000002', N'DV22000001')
INSERT [dbo].[CHITIETHD] ([MAHD], [MAKH], [MADV]) VALUES (N'HD22000008', N'KH22000002', N'DV22000003')
INSERT [dbo].[CHITIETHD] ([MAHD], [MAKH], [MADV]) VALUES (N'HD22000003', N'KH22000003', N'DV22000003')
INSERT [dbo].[CHITIETHD] ([MAHD], [MAKH], [MADV]) VALUES (N'HD22000004', N'KH22000003', N'DV22000004')
INSERT [dbo].[CHITIETHD] ([MAHD], [MAKH], [MADV]) VALUES (N'HD22000011', N'KH22000003', N'DV22000005')
INSERT [dbo].[CHITIETHD] ([MAHD], [MAKH], [MADV]) VALUES (N'HD22000010', N'KH22000004', N'DV22000002')
INSERT [dbo].[CHITIETHD] ([MAHD], [MAKH], [MADV]) VALUES (N'HD22000005', N'KH22000004', N'DV22000006')
INSERT [dbo].[CHITIETHD] ([MAHD], [MAKH], [MADV]) VALUES (N'HD22000009', N'KH22000005', N'DV22000004')
INSERT [dbo].[CHITIETHD] ([MAHD], [MAKH], [MADV]) VALUES (N'HD22000006', N'KH22000005', N'DV22000005')
GO
INSERT [dbo].[PHIEUDANGKY] ([MADK], [NGAYDANGKY], [MAKH], [GHICHU], [MADV]) VALUES (N'PDK0000001', CAST(N'2022-02-01' AS Date), N'KH22000001', N'ĐĂNG KÝ', N'DV22000001')
INSERT [dbo].[PHIEUDANGKY] ([MADK], [NGAYDANGKY], [MAKH], [GHICHU], [MADV]) VALUES (N'PDK0000002', CAST(N'2022-02-13' AS Date), N'KH22000002', N'ĐĂNG KÝ', N'DV22000001')
INSERT [dbo].[PHIEUDANGKY] ([MADK], [NGAYDANGKY], [MAKH], [GHICHU], [MADV]) VALUES (N'PDK0000003', CAST(N'2022-02-24' AS Date), N'KH22000003', N'ĐĂNG KÝ', N'DV22000003')
INSERT [dbo].[PHIEUDANGKY] ([MADK], [NGAYDANGKY], [MAKH], [GHICHU], [MADV]) VALUES (N'PDK0000004', CAST(N'2022-03-02' AS Date), N'KH22000003', N'ĐĂNG KÝ', N'DV22000004')
INSERT [dbo].[PHIEUDANGKY] ([MADK], [NGAYDANGKY], [MAKH], [GHICHU], [MADV]) VALUES (N'PDK0000005', CAST(N'2022-03-15' AS Date), N'KH22000004', N'ĐĂNG KÝ', N'DV22000006')
INSERT [dbo].[PHIEUDANGKY] ([MADK], [NGAYDANGKY], [MAKH], [GHICHU], [MADV]) VALUES (N'PDK0000006', CAST(N'2022-03-26' AS Date), N'KH22000005', N'ĐĂNG KÝ', N'DV22000005')
INSERT [dbo].[PHIEUDANGKY] ([MADK], [NGAYDANGKY], [MAKH], [GHICHU], [MADV]) VALUES (N'PDK0000007', CAST(N'2022-04-05' AS Date), N'KH22000001', N'ĐĂNG KÝ', N'DV22000002')
INSERT [dbo].[PHIEUDANGKY] ([MADK], [NGAYDANGKY], [MAKH], [GHICHU], [MADV]) VALUES (N'PDK0000008', CAST(N'2022-04-20' AS Date), N'KH22000002', N'ĐĂNG KÝ', N'DV22000003')
INSERT [dbo].[PHIEUDANGKY] ([MADK], [NGAYDANGKY], [MAKH], [GHICHU], [MADV]) VALUES (N'PDK0000009', CAST(N'2022-04-30' AS Date), N'KH22000005', N'ĐĂNG KÝ', N'DV22000004')
INSERT [dbo].[PHIEUDANGKY] ([MADK], [NGAYDANGKY], [MAKH], [GHICHU], [MADV]) VALUES (N'PDK0000010', CAST(N'2022-05-03' AS Date), N'KH22000004', N'ĐĂNG KÝ', N'DV22000002')
INSERT [dbo].[PHIEUDANGKY] ([MADK], [NGAYDANGKY], [MAKH], [GHICHU], [MADV]) VALUES (N'PDK0000011', CAST(N'2022-05-20' AS Date), N'KH22000003', N'ĐĂNG KÝ', N'DV22000005')
INSERT [dbo].[PHIEUDANGKY] ([MADK], [NGAYDANGKY], [MAKH], [GHICHU], [MADV]) VALUES (N'PDK0000012', CAST(N'2022-05-28' AS Date), N'KH22000001', N'ĐĂNG KÝ', N'DV22000004')
GO
